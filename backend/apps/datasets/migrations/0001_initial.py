# Generated by Django 4.2.15 on 2025-08-30 05:11

import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='DataImportLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('batch_id', models.CharField(max_length=100, unique=True, verbose_name='批次ID')),
                ('source_file', models.CharField(max_length=500, verbose_name='源文件路径')),
                ('status', models.CharField(choices=[('started', '开始'), ('processing', '处理中'), ('completed', '完成'), ('failed', '失败'), ('cancelled', '取消')], default='started', max_length=20, verbose_name='状态')),
                ('total_rows', models.IntegerField(default=0, verbose_name='总行数')),
                ('processed_rows', models.IntegerField(default=0, verbose_name='已处理行数')),
                ('success_rows', models.IntegerField(default=0, verbose_name='成功行数')),
                ('error_rows', models.IntegerField(default=0, verbose_name='错误行数')),
                ('start_time', models.DateTimeField(default=django.utils.timezone.now, verbose_name='开始时间')),
                ('end_time', models.DateTimeField(blank=True, null=True, verbose_name='结束时间')),
                ('duration_seconds', models.FloatField(blank=True, null=True, verbose_name='持续时间(秒)')),
                ('error_message', models.TextField(blank=True, verbose_name='错误信息')),
                ('import_summary', models.JSONField(default=dict, verbose_name='导入摘要')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '数据导入日志',
                'verbose_name_plural': '数据导入日志',
                'db_table': 'data_import_logs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Department',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=300, verbose_name='部门/机构名称')),
                ('short_name', models.CharField(blank=True, max_length=50, verbose_name='简称')),
                ('department_type', models.CharField(default='Agency', max_length=50, verbose_name='部门类型')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '政府部门',
                'verbose_name_plural': '政府部门',
                'db_table': 'departments',
                'ordering': ['portfolio__name', 'name'],
            },
        ),
        migrations.CreateModel(
            name='Outcome',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('outcome_number', models.CharField(max_length=20, verbose_name='目标编号')),
                ('description', models.TextField(verbose_name='目标描述')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='outcomes', to='datasets.department', verbose_name='所属部门')),
            ],
            options={
                'verbose_name': '目标成果',
                'verbose_name_plural': '目标成果',
                'db_table': 'outcomes',
                'ordering': ['department__name', 'outcome_number'],
                'unique_together': {('department', 'outcome_number')},
            },
        ),
        migrations.CreateModel(
            name='Portfolio',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=200, unique=True, verbose_name='部门组合名称')),
                ('description', models.TextField(blank=True, verbose_name='描述')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '部门组合',
                'verbose_name_plural': '部门组合',
                'db_table': 'portfolios',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Program',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('program_number', models.CharField(max_length=20, verbose_name='项目编号')),
                ('name', models.CharField(max_length=400, verbose_name='项目名称')),
                ('description', models.TextField(blank=True, verbose_name='项目描述')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='programs', to='datasets.department', verbose_name='所属部门')),
                ('outcome', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='programs', to='datasets.outcome', verbose_name='对应目标')),
            ],
            options={
                'verbose_name': '政府项目',
                'verbose_name_plural': '政府项目',
                'db_table': 'programs',
                'ordering': ['department__name', 'program_number'],
                'unique_together': {('department', 'program_number')},
            },
        ),
        migrations.AddField(
            model_name='department',
            name='portfolio',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='departments', to='datasets.portfolio', verbose_name='所属部门组合'),
        ),
        migrations.AlterUniqueTogether(
            name='department',
            unique_together={('portfolio', 'name')},
        ),
        migrations.CreateModel(
            name='BudgetExpense',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('expense_type', models.CharField(choices=[('Departmental Expenses', '部门支出'), ('Administered Expenses', '管理支出'), ('Administered Capital', '管理资本'), ('Special Appropriation', '特殊拨款'), ('Other', '其他')], max_length=100, verbose_name='支出类型')),
                ('appropriation_type', models.CharField(choices=[('Departmental appropriation', '部门拨款'), ('s74 External Revenue', 'S74外部收入'), ('Administered appropriation', '管理拨款'), ('Special appropriation', '特殊拨款'), ('Expenses not requiring appropriation in the Budget year', '预算年度不需要拨款的支出'), ('Other', '其他')], max_length=150, verbose_name='拨款类型')),
                ('description', models.TextField(blank=True, verbose_name='支出描述')),
                ('amount_2023_24', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(0)], verbose_name='2023-24财年金额')),
                ('amount_2024_25', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(0)], verbose_name='2024-25财年金额')),
                ('amount_2025_26', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(0)], verbose_name='2025-26财年金额')),
                ('amount_2026_27', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(0)], verbose_name='2026-27财年金额')),
                ('amount_2027_28', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(0)], verbose_name='2027-28财年金额')),
                ('source_document', models.CharField(blank=True, max_length=200, verbose_name='源文档')),
                ('source_table', models.CharField(blank=True, max_length=100, verbose_name='源表格')),
                ('source_url', models.URLField(blank=True, verbose_name='源URL')),
                ('raw_data_hash', models.CharField(blank=True, max_length=64, verbose_name='原始数据哈希')),
                ('import_batch', models.CharField(blank=True, max_length=100, verbose_name='导入批次')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='datasets.department', verbose_name='部门/机构')),
                ('outcome', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='datasets.outcome', verbose_name='目标成果')),
                ('portfolio', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='datasets.portfolio', verbose_name='部门组合')),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='datasets.program', verbose_name='项目')),
            ],
            options={
                'verbose_name': '预算支出',
                'verbose_name_plural': '预算支出',
                'db_table': 'budget_expenses',
                'ordering': ['portfolio__name', 'department__name', 'program__program_number'],
                'indexes': [models.Index(fields=['portfolio', 'department'], name='budget_expe_portfol_7ad7e1_idx'), models.Index(fields=['expense_type'], name='budget_expe_expense_05596f_idx'), models.Index(fields=['appropriation_type'], name='budget_expe_appropr_58b142_idx'), models.Index(fields=['amount_2024_25'], name='budget_expe_amount__b7143d_idx'), models.Index(fields=['import_batch'], name='budget_expe_import__e814da_idx'), models.Index(fields=['created_at'], name='budget_expe_created_35f11a_idx')],
            },
        ),
    ]
